<?php

$str='<Widevine_Message><QueryEntitlementResponse StartOffset="0" MaxResponses="100" SessionID="16289" SequenceNumber="3"><CA_OK></CA_OK><Entitlements><Entitlement><CA_ID>1141621</CA_ID><VerboseName>101006D424895__digi_1</VerboseName><AssetID></AssetID><ServiceGroupID>digi_1</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2007-01-28T19:15:31Z</DateStart><DateEnd>2017-01-25T19:15:31Z</DateEnd></Entitlement><Entitlement><CA_ID>1141622</CA_ID><VerboseName>101006D424895__digi_5</VerboseName><AssetID></AssetID><ServiceGroupID>digi_5</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2007-01-28T19:15:32Z</DateStart><DateEnd>2017-01-25T19:15:32Z</DateEnd></Entitlement><Entitlement><CA_ID>1141623</CA_ID><VerboseName>101006D424895__digi_7</VerboseName><AssetID></AssetID><ServiceGroupID>digi_7</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2007-01-28T19:15:32Z</DateStart><DateEnd>2017-01-25T19:15:32Z</DateEnd></Entitlement><Entitlement><CA_ID>1141624</CA_ID><VerboseName>101006D424895__digi_9</VerboseName><AssetID></AssetID><ServiceGroupID>digi_9</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2007-01-28T19:15:32Z</DateStart><DateEnd>2017-01-25T19:15:32Z</DateEnd></Entitlement><Entitlement><CA_ID>1141625</CA_ID><VerboseName>101006D424895__soome_plus_2</VerboseName><AssetID></AssetID><ServiceGroupID>soome_plus_2</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2007-01-28T19:15:32Z</DateStart><DateEnd>2017-01-25T19:15:32Z</DateEnd></Entitlement><Entitlement><CA_ID>1141626</CA_ID><VerboseName>101006D424895__xtra_music</VerboseName><AssetID></AssetID><ServiceGroupID>xtra_music</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2007-01-28T19:15:32Z</DateStart><DateEnd>2017-01-25T19:15:32Z</DateEnd></Entitlement><Entitlement><CA_ID>1141627</CA_ID><VerboseName>101006D424895__soome_plus</VerboseName><AssetID></AssetID><ServiceGroupID>soome_plus</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2007-01-28T19:15:32Z</DateStart><DateEnd>2017-01-25T19:15:32Z</DateEnd></Entitlement><Entitlement><CA_ID>1474885</CA_ID><VerboseName>101006D424895__muusika</VerboseName><AssetID></AssetID><ServiceGroupID>muusika</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2007-07-29T10:43:40Z</DateStart><DateEnd>2017-07-26T10:43:40Z</DateEnd></Entitlement><Entitlement><CA_ID>1474886</CA_ID><VerboseName>101006D424895__teadus_ja_kultuur</VerboseName><AssetID></AssetID><ServiceGroupID>teadus_ja_kultuur</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2007-07-29T10:43:41Z</DateStart><DateEnd>2017-07-26T10:43:41Z</DateEnd></Entitlement><Entitlement><CA_ID>1474887</CA_ID><VerboseName>101006D424895__sport</VerboseName><AssetID></AssetID><ServiceGroupID>sport</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2007-07-29T10:43:41Z</DateStart><DateEnd>2017-07-26T10:43:41Z</DateEnd></Entitlement><Entitlement><CA_ID>1474890</CA_ID><VerboseName>101006D424895__lastele</VerboseName><AssetID></AssetID><ServiceGroupID>lastele</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2007-07-29T10:43:41Z</DateStart><DateEnd>2017-07-26T10:43:41Z</DateEnd></Entitlement><Entitlement><CA_ID>1474892</CA_ID><VerboseName>101006D424895__slaavi</VerboseName><AssetID></AssetID><ServiceGroupID>slaavi</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2007-07-29T10:43:41Z</DateStart><DateEnd>2017-07-26T10:43:41Z</DateEnd></Entitlement><Entitlement><CA_ID>1474895</CA_ID><VerboseName>101006D424895__meelelahutus</VerboseName><AssetID></AssetID><ServiceGroupID>meelelahutus</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2007-07-29T10:43:41Z</DateStart><DateEnd>2017-07-26T10:43:41Z</DateEnd></Entitlement><Entitlement><CA_ID>1474896</CA_ID><VerboseName>101006D424895__uudised</VerboseName><AssetID></AssetID><ServiceGroupID>uudised</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2007-07-29T10:43:41Z</DateStart><DateEnd>2017-07-26T10:43:41Z</DateEnd></Entitlement><Entitlement><CA_ID>1474899</CA_ID><VerboseName>101006D424895__motors_tv</VerboseName><AssetID></AssetID><ServiceGroupID>motors_tv</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2007-07-29T10:43:41Z</DateStart><DateEnd>2017-07-26T10:43:41Z</DateEnd></Entitlement><Entitlement><CA_ID>2880653</CA_ID><VerboseName>101006D424895__digi_0</VerboseName><AssetID></AssetID><ServiceGroupID>digi_0</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2008-01-12T14:46:18Z</DateStart><DateEnd>2018-01-09T14:46:18Z</DateEnd></Entitlement><Entitlement><CA_ID>2880659</CA_ID><VerboseName>101006D424895__mcm_top</VerboseName><AssetID></AssetID><ServiceGroupID>mcm_top</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2008-01-12T14:46:19Z</DateStart><DateEnd>2018-01-09T14:46:19Z</DateEnd></Entitlement><Entitlement><CA_ID>2880661</CA_ID><VerboseName>101006D424895__eurosport</VerboseName><AssetID></AssetID><ServiceGroupID>eurosport</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2008-01-12T14:46:19Z</DateStart><DateEnd>2018-01-09T14:46:19Z</DateEnd></Entitlement><Entitlement><CA_ID>2880662</CA_ID><VerboseName>101006D424895__deutche_welle</VerboseName><AssetID></AssetID><ServiceGroupID>deutche_welle</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2008-01-12T14:46:19Z</DateStart><DateEnd>2018-01-09T14:46:19Z</DateEnd></Entitlement><Entitlement><CA_ID>2880664</CA_ID><VerboseName>101006D424895__vh_1</VerboseName><AssetID></AssetID><ServiceGroupID>vh_1</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2008-01-12T14:46:20Z</DateStart><DateEnd>2018-01-09T14:46:20Z</DateEnd></Entitlement><Entitlement><CA_ID>2880665</CA_ID><VerboseName>101006D424895__nat_geo_wild</VerboseName><AssetID></AssetID><ServiceGroupID>nat_geo_wild</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2008-01-12T14:46:20Z</DateStart><DateEnd>2018-01-09T14:46:20Z</DateEnd></Entitlement><Entitlement><CA_ID>2880666</CA_ID><VerboseName>101006D424895__discovery_chann</VerboseName><AssetID></AssetID><ServiceGroupID>discovery_chann</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2008-01-12T14:46:20Z</DateStart><DateEnd>2018-01-09T14:46:20Z</DateEnd></Entitlement><Entitlement><CA_ID>2880667</CA_ID><VerboseName>101006D424895__animal_planet</VerboseName><AssetID></AssetID><ServiceGroupID>animal_planet</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2008-01-12T14:46:20Z</DateStart><DateEnd>2018-01-09T14:46:20Z</DateEnd></Entitlement><Entitlement><CA_ID>2880668</CA_ID><VerboseName>101006D424895__fashion</VerboseName><AssetID></AssetID><ServiceGroupID>fashion</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2008-01-12T14:46:20Z</DateStart><DateEnd>2018-01-09T14:46:20Z</DateEnd></Entitlement><Entitlement><CA_ID>2880669</CA_ID><VerboseName>101006D424895__sat_1</VerboseName><AssetID></AssetID><ServiceGroupID>sat_1</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2008-01-12T14:46:20Z</DateStart><DateEnd>2018-01-09T14:46:20Z</DateEnd></Entitlement><Entitlement><CA_ID>2880670</CA_ID><VerboseName>101006D424895__rtl_tv</VerboseName><AssetID></AssetID><ServiceGroupID>rtl_tv</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2008-01-12T14:46:20Z</DateStart><DateEnd>2018-01-09T14:46:20Z</DateEnd></Entitlement><Entitlement><CA_ID>2880671</CA_ID><VerboseName>101006D424895__rai_uno</VerboseName><AssetID></AssetID><ServiceGroupID>rai_uno</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2008-01-12T14:46:20Z</DateStart><DateEnd>2018-01-09T14:46:20Z</DateEnd></Entitlement><Entitlement><CA_ID>2880672</CA_ID><VerboseName>101006D424895__tv_5</VerboseName><AssetID></AssetID><ServiceGroupID>tv_5</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2008-01-12T14:46:20Z</DateStart><DateEnd>2018-01-09T14:46:20Z</DateEnd></Entitlement><Entitlement><CA_ID>2880673</CA_ID><VerboseName>101006D424895__mezzo</VerboseName><AssetID></AssetID><ServiceGroupID>mezzo</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2008-01-12T14:46:20Z</DateStart><DateEnd>2018-01-09T14:46:20Z</DateEnd></Entitlement><Entitlement><CA_ID>2880674</CA_ID><VerboseName>101006D424895__star</VerboseName><AssetID></AssetID><ServiceGroupID>star</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2008-01-12T14:46:20Z</DateStart><DateEnd>2018-01-09T14:46:20Z</DateEnd></Entitlement><Entitlement><CA_ID>2880675</CA_ID><VerboseName>101006D424895__bbc_prime</VerboseName><AssetID></AssetID><ServiceGroupID>bbc_prime</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2008-01-12T14:46:20Z</DateStart><DateEnd>2018-01-09T14:46:20Z</DateEnd></Entitlement><Entitlement><CA_ID>2880676</CA_ID><VerboseName>101006D424895__rtr_planeta</VerboseName><AssetID></AssetID><ServiceGroupID>rtr_planeta</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2008-01-12T14:46:20Z</DateStart><DateEnd>2018-01-09T14:46:20Z</DateEnd></Entitlement><Entitlement><CA_ID>2880677</CA_ID><VerboseName>101006D424895__euronews</VerboseName><AssetID></AssetID><ServiceGroupID>euronews</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2008-01-12T14:46:20Z</DateStart><DateEnd>2018-01-09T14:46:20Z</DateEnd></Entitlement><Entitlement><CA_ID>2880678</CA_ID><VerboseName>101006D424895__mtv_eesti</VerboseName><AssetID></AssetID><ServiceGroupID>mtv_eesti</ServiceGroupID><SubscriberID>4706978</SubscriberID><CPEID>101006D424895</CPEID><DateStart>2008-01-12T14:46:20Z</DateStart><DateEnd>2018-01-09T14:46:20Z</DateEnd></Entitlement></Entitlements></QueryEntitlementResponse></Widevine_Message>';



//print_r(xml2array($str,array('Widevine_Message','QueryEntitlementResponse','Entitlements')));







$GLOBALS['XMLRPC-entities']=array(
	'&'=>'&amp;','<'=>'&lt;','>'=>'&gt;','"'=>'&quot;',"'"=>'&apos;');

$GLOBALS['XMLRPC-options']=array(
	'output_type'=>'xml',
	'verbosity'=>'',
	'escaping'=>'',
	'version'=>'xmlrpc',
	'encoding'=>'iso-8859-1');


class _xmlrpcRequest{
	var $result;
	var $fault=true;
	var $faultCode=0;
	var $faultString='';

	function _xmlrpcRequest(){
		$args=func_get_args();
		$server=array_shift($args);
		$data=call_user_func_array('xmlrpc_encode_request',$args);
		$data=xml_request($server,$data);
		if(strpos($data,'<fault>')){
			$data=xmlrpc_decode($data);
			$this->faultCode=$data['faultCode'];
			$this->faultString=$data['faultString'];
		}else{
			$this->result=xmlrpc_decode($data);
			$this->fault=false;
		}
	}
}

function _xmlrpc_encode_fault($code=0,$msg=''){
	$opts=$GLOBALS['XMLRPC-options'];
	$fault=_xmlrpc_encode_param(array('faultCode'=>$code,'faultString'=>$msg));
	$msg="<methodResponse><fault>$fault</fault></methodResponse>";
	return "<?xml version='1.0' encoding='{$opts['encoding']}'?>\r\n$msg";
}

function _xmlrpc_encode_param($param){
	$type=gettype($param);
	if($type=='array'){
		$mask='<data>%v</data>';
		for($i=0,$keys=array_keys($param),$size=count($keys);$i<$size;$i++){
			if($i!==$keys[$i]){$type='struct';$mask='<member><name>%k</name>%v</member>';break;}
		}
	}
	if(isset($mask)){
		foreach($param as $k=>$v){
			$param[$k]=str_replace('%v',_xmlrpc_encode_param($v), str_replace('%k',$k,$mask) );
		}
		$param=implode("\r\n",$param);
	}elseif($type=='integer'){$type='i4';}
	elseif($type=='boolean'){$param=($param)?'1':'0';}
	else{$param=strtr($param, $GLOBALS['XMLRPC-entities'] );}
	return "<value><$type>$param</$type></value>";
}

function xml_request($server,$data){
	$accepted_charset_encodings=array('UTF-8','ISO-8859-1','US-ASCII');
	if(strpos($server,'@')){
		list($user,$server)=explode('@',$server);
		list($user,$pass)=explode(':',$user.':');
	}
	if(strpos($server,'/')){list($server,$uri)=explode('/',$server,2);}else $uri='';
	if(strpos($server,':')){list($server,$port)=explode(':',$server);}else $port='80';

	$op="POST /$uri HTTP/1.0\r\n".
		"User-Agent: XML-RPC Client\r\n".
		"Host: $server:$port\r\n";
	if(isset($user,$pass)){
		$op.="Authorization: Basic ".base64_encode("$user:$pass")."\r\n";
	}
	$op.="Accept-Charset: ".implode(',',$accepted_charset_encodings)."\r\n";
	$op.="Content-Type: text/xml\r\n";
	$op.="Content-Length: ".strlen($data)."\r\n\r\n$data";

	if(($fp=@fsockopen($server,$port,$errno,$errstr,5))===false)
		return _xmlrpc_encode_fault(0,"Connect error: $errstr");
	if(!fwrite($fp, $op, strlen($op)))
		return _xmlrpc_encode_fault(0,"Write error");

	$result='';
	while($data=fread($fp,32768)){$result.=$data;}
	//while(!feof($fp)){$result.=fgets($fp,128);}

	fclose($fp);

	$pos=strpos($result,'<');
	if($pos===false){
		return _xmlrpc_encode_fault(0,'No XML data');
	}
	return substr($result,$pos);
}

if(!function_exists('xmlrpc_encode_request')){	// XML-RPC Functions
  function xmlrpc_encode_request(){
	$opts=$GLOBALS['XMLRPC-options'];
	$args=func_get_args();
	$i=count($args);
	if($i>2&&is_array($args[$i-1])){
		$valid=true;
		foreach($args[$i-1] as $k=>$v){
			if(isset($opts[$k])){$opts[$k]=$v;}else{$valid=false;break;}
		}
		if($valid)unset($args[--$i]);
	}
	$msg="<methodCall>\r\n";
	if($i>1){
		$msg.="<methodName>".array_shift($args)."</methodName>\r\n";
		$msg.=_xmlrpc_params($args);
	}
	$msg.="</methodCall>\r\n";
	return "<?xml version='1.0' encoding='{$opts['encoding']}'?>\r\n$msg";
  }

  function xmlrpc_encode(){
	$opts=$GLOBALS['XMLRPC-options'];
	$args=func_get_args();
	$msg=_xmlrpc_params($args);
	return "<?xml version='1.0' encoding='{$opts['encoding']}'?>\r\n$msg";
  }

  function xmlrpc_decode($xml,$server=false){
	$xml_parser=xml_parser_create();
	if(!xml_parse_into_struct($xml_parser,$xml,$vals)){return false;}
	xml_parser_free($xml_parser);
	$output=$server_output=$trace=array();
	$opt=array('methodname'=>0,'fault'=>0);
	$types=array('int'=>'(int)','i4'=>'(int)','string'=>'(string)','boolean'=>'(boolean)');
	$sub='';
	$entities=array_flip(array_reverse($GLOBALS['XMLRPC-entities'],true));
	foreach($vals as $k=>$v){
		$v['tag']=strtolower($v['tag']);
		if($v['tag']=='methodcall'){$server=true;}
		elseif($server&&$v['tag']=='param'&&$v['type']=='close'){
			$server_output[]=$output;
			$output=array();
		}elseif(in_array($v['tag'],
			array('methodcall','methodresponse','params','param','value','array','struct'))){
		}elseif(isset($opt[$v['tag']])){
			$opt[$v['tag']]=(empty($v['value']))?'1':$v['value'];
		}elseif($v['type']=='open'){
			if($v['tag']=='member'||$v['tag']=='data')$sub='[]';
			else $trace[]=strtolower($v['tag']);
		}elseif($v['type']=='close'){
			if($v['tag']=='member'||$v['tag']=='data')$sub='';
			else unset($trace[(count($trace)-1)]);
		}elseif($v['type']=='complete'){
			if(isset($types[$v['tag']])){$type=$types[$v['tag']];}else{$type='';}
			if($sub&&$v['tag']=='name')$sub="['{$v['value']}']";
			if($type=='boolean')$v['value']=($v['value'])?true:false;
			elseif($type=='string')$v['value']=strtr($v['value'],$entities);
			if(count($trace)>0){$t=implode("']['",$trace);$t="['$t']";}else{$t='';}
			eval('$output'.$t.$sub.'='.$type.'$v["value"];');
		}
	}
	if($server){
		return array($opt['methodname'],$server_output);
	}
	return $output;
  }

  function _xmlrpc_params($params,$msg=''){
	foreach($params as $k=>$v){
		$v=_xmlrpc_encode_param($v);
		$msg.="<param>$v</param>\r\n";
	}
	return "<params>\r\n$msg</params>\r\n";
  }
}	// XML-RPC Functions




$data=array('tere',1,array('kala',2));

print_r($data);
$str=xmlrpc_encode($data);

echo $str;

//$data=xmlrpc_decode($str,1);
//print_r($data);

print_r( xml2array($str,array('params','param','value','array','struct','member','data')) );


/*
define('_XMLRPC_ST','marvin:krSwb3z@lauriro.tln.et.ee/xml_st.php');

$data=new _xmlrpcRequest(_XMLRPC_ST,'SpeedTouch.info','test');

if($data->fault){
	return "Viga: {$this->faultCode} [$this->faultString]\n";
}
print_r($data->result);

*/








function xml2array($xml,$ignore=array(),$get_attributes=0){
	if(
		($p=xml_parser_create())!==false &&
		xml_parser_set_option($p,XML_OPTION_CASE_FOLDING,0) &&
		xml_parser_set_option($p,XML_OPTION_SKIP_WHITE,1) &&
		xml_parse_into_struct($p,$xml,$vals) ){
		xml_parser_free($p);
	}else{
		return false;
	}

	$xml=$parent=array();
	$current=&$xml;

	foreach($vals as $v){
		$v['tag']=strtolower($v['tag']);

		if($get_attributes){
			$result=array();
			if(isset($v['attributes'])){
				$result=$v['attributes'];
			}
			if(isset($v['value']))$result['value']=$v['value'];
		}elseif(isset($v['value'])){$result=$v['value'];}else{$result='';}

		if($v['type']=='open'){
			if(in_array($v['tag'],$ignore))continue;
			$parent[$v['level']-1]=&$current;
			if(is_array($current)&&(in_array($v['tag'],array_keys($current)))){
				if(isset($current[$v['tag']][0])){array_push($current[$v['tag']],$result);}
				else{$current[$v['tag']]=array($current[$v['tag']],$result);}
				$current=&$current[$v['tag']][ count($current[$v['tag']])-1 ];
			}else{
				$current[$v['tag']]=$result;
				$current=&$current[$v['tag']];
			}
		}elseif($v['type']=='complete'){
			if(isset($types[$v['tag']])&&is_string($result)){
			//	eval('$result='.$types[$v['tag']].'$result');
				$current=&$parent[$v['level']-1];
			
			}
			if(isset($current[$v['tag']])){
				if( (is_array($current[$v['tag']])&&$get_attributes==0) ||
					(isset($current[$v['tag']][0])&&is_array($current[$v['tag']][0])&&$get_attributes==1)){
					array_push($current[$v['tag']],$result);
				}else{$current[$v['tag']]=array($current[$v['tag']],$result);}
			}else{$current[$v['tag']]=$result;}
		}elseif($v['type']=='close'&&!isset($types[$v['tag']])){$current=&$parent[$v['level']-1];}
	}
	return($xml);
} 

?>